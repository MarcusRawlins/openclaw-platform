# Daily Briefing System

**Priority:** High
**Estimated Time:** 2 days
**Dependencies:** AnselAI Phase 2+ (social analytics), Content Idea Pipeline

## Goal

Automated daily briefing generated by Marcus every morning. Covers content performance (last 90 days), social metrics, active ideas, upcoming tasks, and key insights. Delivered to Tyler via Telegram.

## Overview

**What it does:**
1. Collects data from multiple sources (AnselAI DB, Mission Control, content catalog)
2. Generates intelligent summary using local LLM
3. Formats as readable briefing with sections
4. Posts to Tyler's Telegram at 7:00 AM EST
5. Optionally sends to other channels (Slack, email)

**Sections:**
- Content Performance (last 7 days + 30 days)
- Top Performing Content (90-day rolling catalog)
- Social Growth Metrics
- Active Content Ideas
- Tasks Due Today
- Insights & Recommendations

## Architecture

```
Cron Job: Daily at 7:00 AM EST
         â†“
    Marcus (briefing-generator.js)
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Data Collection                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  1. AnselAI DB                             â”‚
    â”‚     â†’ Content metrics (views, engagement)  â”‚
    â”‚     â†’ Social analytics (followers, reach)  â”‚
    â”‚     â†’ Content ideas (proposed, active)     â”‚
    â”‚                                             â”‚
    â”‚  2. Mission Control                        â”‚
    â”‚     â†’ Tasks (today's schedule)             â”‚
    â”‚     â†’ Agent activity                       â”‚
    â”‚                                             â”‚
    â”‚  3. Content Catalog                        â”‚
    â”‚     â†’ Rolling 90-day window                â”‚
    â”‚     â†’ Performance rankings                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    LLM Summary Generation (local)
         â†“
    Format Briefing (markdown)
         â†“
    Post to Telegram
```

## Database: Content Catalog

**File:** AnselAI database, add new table:

```sql
-- Content catalog (rolling 90-day window)
CREATE TABLE content_catalog (
  id SERIAL PRIMARY KEY,
  content_id INTEGER REFERENCES content(id), -- Links to content table
  platform VARCHAR(50),
  title VARCHAR(500),
  published_at DATE NOT NULL,
  
  -- Performance snapshots (daily)
  snapshot_date DATE NOT NULL,
  views INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  comments INTEGER DEFAULT 0,
  shares INTEGER DEFAULT 0,
  saves INTEGER DEFAULT 0, -- Instagram-specific
  watch_time INTEGER, -- YouTube-specific (seconds)
  
  -- Calculated metrics
  engagement_rate DECIMAL(8,4), -- (likes + comments + shares) / views
  
  -- Metadata
  synced_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(content_id, snapshot_date)
);

-- Indexes
CREATE INDEX idx_catalog_date ON content_catalog(snapshot_date);
CREATE INDEX idx_catalog_platform ON content_catalog(platform);
CREATE INDEX idx_catalog_performance ON content_catalog(engagement_rate DESC);

-- Auto-cleanup old data (>90 days)
CREATE OR REPLACE FUNCTION cleanup_old_catalog() RETURNS void AS $$
BEGIN
  DELETE FROM content_catalog WHERE snapshot_date < NOW() - INTERVAL '90 days';
END;
$$ LANGUAGE plpgsql;
```

## Phase 1: Data Collection

### 1.1 Content Performance (Last 7 & 30 Days)

**File:** `skills/daily-briefing/collect-content-metrics.js`

```javascript
async function getContentPerformance() {
  // Last 7 days
  const last7Days = await db.query(`
    SELECT 
      platform,
      COUNT(*) as posts,
      SUM(views) as total_views,
      AVG(engagement_rate) as avg_engagement,
      SUM(likes) as total_likes,
      SUM(comments) as total_comments,
      SUM(shares) as total_shares
    FROM content_catalog
    WHERE snapshot_date >= NOW() - INTERVAL '7 days'
    GROUP BY platform
  `);
  
  // Last 30 days
  const last30Days = await db.query(`
    SELECT 
      platform,
      COUNT(*) as posts,
      SUM(views) as total_views,
      AVG(engagement_rate) as avg_engagement
    FROM content_catalog
    WHERE snapshot_date >= NOW() - INTERVAL '30 days'
    GROUP BY platform
  `);
  
  return { last7Days, last30Days };
}
```

### 1.2 Top Performing Content (90-Day Rolling)

```javascript
async function getTopContent(limit = 10) {
  return await db.query(`
    SELECT 
      c.id,
      c.title,
      c.platform,
      c.published_at,
      cat.views,
      cat.engagement_rate,
      cat.likes,
      cat.comments,
      cat.shares
    FROM content c
    JOIN content_catalog cat ON c.id = cat.content_id
    WHERE cat.snapshot_date >= NOW() - INTERVAL '90 days'
    ORDER BY cat.engagement_rate DESC, cat.views DESC
    LIMIT $1
  `, [limit]);
}
```

### 1.3 Social Growth Metrics

```javascript
async function getSocialGrowth() {
  // Yesterday vs. 7 days ago
  const instagram = await db.query(`
    SELECT 
      metric_value as followers
    FROM metrics
    WHERE platform = 'instagram'
      AND metric_type = 'followers'
      AND period_start = CURRENT_DATE - 1
  `);
  
  const instagramWeekAgo = await db.query(`
    SELECT metric_value as followers
    FROM metrics
    WHERE platform = 'instagram'
      AND metric_type = 'followers'
      AND period_start = CURRENT_DATE - 7
  `);
  
  // Calculate growth
  const growth = instagram[0].followers - instagramWeekAgo[0].followers;
  
  // Repeat for other platforms (YouTube, TikTok, Pinterest, Twitter)
  
  return {
    instagram: {
      current: instagram[0].followers,
      growth7d: growth,
      growthPercent: (growth / instagramWeekAgo[0].followers * 100).toFixed(2)
    }
    // ... other platforms
  };
}
```

### 1.4 Active Content Ideas

```javascript
async function getActiveIdeas() {
  return await db.query(`
    SELECT 
      id,
      title,
      status,
      platform,
      suggested_at,
      task_id
    FROM content_ideas
    WHERE status IN ('proposed', 'accepted', 'in_progress')
    ORDER BY suggested_at DESC
    LIMIT 10
  `);
}
```

### 1.5 Tasks Due Today

```javascript
async function getTodaysTasks() {
  const tasksPath = '/workspace/mission_control/data/tasks.json';
  const tasks = JSON.parse(fs.readFileSync(tasksPath));
  
  // Standing orders (daily recurring)
  const standingOrders = tasks.filter(t => 
    t.status === 'queued' && 
    t.priority === 'high' &&
    (t.title.includes('standing order') || t.description.includes('Daily'))
  );
  
  // Urgent tasks
  const urgent = tasks.filter(t => 
    t.status === 'queued' && 
    t.priority === 'urgent'
  );
  
  return { standingOrders, urgent };
}
```

## Phase 2: Summary Generation

**File:** `skills/daily-briefing/generate-summary.js`

```javascript
async function generateBriefingSummary(data) {
  const prompt = `Generate a concise daily briefing for a photography business owner.

**Content Performance (Last 7 Days):**
${formatContentPerformance(data.contentPerformance.last7Days)}

**Top Performing Content (90 Days):**
${formatTopContent(data.topContent)}

**Social Growth:**
${formatSocialGrowth(data.socialGrowth)}

**Active Ideas:**
${formatActiveIdeas(data.activeIdeas)}

**Today's Tasks:**
${formatTodaysTasks(data.todaysTasks)}

Create a brief summary with:
1. **Headline Insight** â€” One sentence capturing the key takeaway
2. **Performance Highlights** â€” 2-3 notable wins
3. **Areas to Watch** â€” 1-2 things needing attention
4. **Recommendations** â€” 1-2 actionable suggestions

Keep it concise, data-driven, and actionable. Use clear language, no jargon.`;

  const response = await fetch('http://127.0.0.1:1234/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'qwen3:4b',
      messages: [{ role: 'user', content: prompt }],
      temperature: 0.7
    })
  });
  
  const result = await response.json();
  return result.choices[0].message.content;
}
```

## Phase 3: Briefing Formatter

**File:** `skills/daily-briefing/format-briefing.js`

```javascript
function formatBriefing(data, summary) {
  const date = new Date().toLocaleDateString('en-US', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  return `ğŸ“Š **Daily Briefing â€” ${date}**

${summary.headlineInsight}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ¯ Performance Highlights

${summary.performanceHighlights}

## ğŸ“ˆ Last 7 Days

**Content Published:**
${formatContentStats(data.contentPerformance.last7Days)}

**Top Performer:**
${formatTopPost(data.topContent[0])}

## ğŸŒ± Social Growth (7 Days)

${formatSocialGrowthDetails(data.socialGrowth)}

## ğŸ’¡ Active Ideas (${data.activeIdeas.length})

${data.activeIdeas.slice(0, 3).map(idea => 
  `â€¢ **${idea.title}** (${idea.status}) â€” ${idea.platform}`
).join('\n')}

${data.activeIdeas.length > 3 ? `_+ ${data.activeIdeas.length - 3} more in pipeline_` : ''}

## ğŸ“‹ Today's Tasks

${data.todaysTasks.urgent.length > 0 ? 
  '**URGENT:**\n' + data.todaysTasks.urgent.map(t => `â€¢ ${t.title}`).join('\n') + '\n\n' : ''}

**Standing Orders:**
${data.todaysTasks.standingOrders.map(t => `â€¢ ${t.title}`).join('\n')}

## âš ï¸ Areas to Watch

${summary.areasToWatch}

## ğŸ’ª Recommendations

${summary.recommendations}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

_View full metrics in Mission Control â†’ AnselAI_`;
}
```

## Phase 4: Main Briefing Generator

**File:** `/agents/main/briefing-generator.js`

```javascript
const collectContent = require('../../skills/daily-briefing/collect-content-metrics');
const collectSocial = require('../../skills/daily-briefing/collect-social-metrics');
const collectIdeas = require('../../skills/daily-briefing/collect-ideas');
const collectTasks = require('../../skills/daily-briefing/collect-tasks');
const generateSummary = require('../../skills/daily-briefing/generate-summary');
const formatBriefing = require('../../skills/daily-briefing/format-briefing');

async function generateDailyBriefing() {
  console.log('Generating daily briefing...');
  
  // 1. Collect data
  const data = {
    contentPerformance: await collectContent.getContentPerformance(),
    topContent: await collectContent.getTopContent(10),
    socialGrowth: await collectSocial.getSocialGrowth(),
    activeIdeas: await collectIdeas.getActiveIdeas(),
    todaysTasks: await collectTasks.getTodaysTasks()
  };
  
  // 2. Generate AI summary
  const summary = await generateSummary(data);
  
  // 3. Format briefing
  const briefing = formatBriefing(data, summary);
  
  // 4. Save to file (for record-keeping)
  const date = new Date().toISOString().split('T')[0];
  const briefingPath = `/Volumes/reeseai-memory/briefings/${date}-briefing.md`;
  fs.writeFileSync(briefingPath, briefing);
  
  console.log(`âœ“ Briefing saved: ${briefingPath}`);
  
  return briefing;
}

// CLI entry point
if (require.main === module) {
  generateDailyBriefing().then(briefing => {
    console.log(briefing);
  });
}

module.exports = { generateDailyBriefing };
```

## Phase 5: Cron Integration

**Marcus's Cron Job:**

```javascript
// In Marcus's OpenClaw agent config or via gateway cron

// Daily at 7:00 AM EST
{
  "schedule": { "kind": "cron", "expr": "0 7 * * *", "tz": "America/New_York" },
  "payload": { 
    "kind": "agentTurn", 
    "message": "Generate and send daily briefing",
    "timeoutSeconds": 300
  },
  "delivery": { "mode": "none" }, // Marcus handles delivery
  "sessionTarget": "isolated",
  "enabled": true
}
```

**Marcus's handler:**

```javascript
// When Marcus receives "Generate and send daily briefing" message
async function handleDailyBriefing() {
  // Generate briefing
  const briefing = await exec({
    command: 'node /agents/main/briefing-generator.js'
  });
  
  // Send to Tyler via Telegram
  await message({
    action: 'send',
    channel: 'telegram',
    message: briefing
  });
  
  console.log('âœ“ Daily briefing sent to Tyler');
}
```

## Phase 6: Content Catalog Sync

**File:** `skills/daily-briefing/sync-catalog.js`

**Purpose:** Daily sync to refresh content catalog with latest metrics

```javascript
async function syncContentCatalog() {
  console.log('Syncing content catalog...');
  
  // Get all content published in last 90 days
  const recentContent = await db.query(`
    SELECT id, platform, title, published_at
    FROM content
    WHERE published_at >= NOW() - INTERVAL '90 days'
  `);
  
  for (const content of recentContent) {
    // Fetch latest metrics from AnselAI metrics table
    const metrics = await getLatestMetrics(content.id, content.platform);
    
    // Insert/update catalog snapshot for today
    await db.query(`
      INSERT INTO content_catalog (
        content_id, platform, title, published_at, snapshot_date,
        views, likes, comments, shares, saves, watch_time, engagement_rate
      ) VALUES ($1, $2, $3, $4, CURRENT_DATE, $5, $6, $7, $8, $9, $10, $11)
      ON CONFLICT (content_id, snapshot_date) 
      DO UPDATE SET
        views = EXCLUDED.views,
        likes = EXCLUDED.likes,
        comments = EXCLUDED.comments,
        shares = EXCLUDED.shares,
        engagement_rate = EXCLUDED.engagement_rate,
        synced_at = NOW()
    `, [
      content.id,
      content.platform,
      content.title,
      content.published_at,
      metrics.views,
      metrics.likes,
      metrics.comments,
      metrics.shares,
      metrics.saves,
      metrics.watchTime,
      calculateEngagementRate(metrics)
    ]);
  }
  
  // Cleanup old snapshots (>90 days)
  await db.query('SELECT cleanup_old_catalog()');
  
  console.log(`âœ“ Catalog synced (${recentContent.length} items)`);
}

function calculateEngagementRate(metrics) {
  if (metrics.views === 0) return 0;
  return ((metrics.likes + metrics.comments + metrics.shares) / metrics.views * 100);
}

// Cron: Daily at 6:00 AM (before briefing generation)
```

## Deliverables

- [ ] Content catalog table in AnselAI database
- [ ] Data collection scripts (content, social, ideas, tasks)
- [ ] AI summary generator (local LLM)
- [ ] Briefing formatter (markdown with emojis)
- [ ] Main briefing generator script
- [ ] Cron job integration (7:00 AM daily)
- [ ] Content catalog sync script (6:00 AM daily)
- [ ] Briefing archive directory (/Volumes/reeseai-memory/briefings/)
- [ ] CLI tool: `node briefing-generator.js` (manual trigger)
- [ ] Documentation in SKILL.md
- [ ] Git commit: "feat: daily briefing system with content catalog"

## Testing

1. **Manual generation:**
   - Run `node briefing-generator.js`
   - Verify all data collected
   - Check formatting
   - Confirm Telegram delivery

2. **Cron test:**
   - Set cron to run in 5 minutes
   - Wait for delivery
   - Verify timing accurate

3. **Content catalog:**
   - Publish test content
   - Run sync
   - Verify metrics captured
   - Check 90-day rolling window

4. **Summary quality:**
   - Check insights are relevant
   - Verify recommendations actionable
   - Confirm data accuracy

## Notes

- Briefing generates even if some data sources are empty (graceful degradation)
- Content catalog auto-cleans daily (keeps last 90 days only)
- Summary uses local LLM (no API costs)
- Briefing saved to archive for historical reference
- Can manually trigger: `node briefing-generator.js` anytime
- Future: add weekly/monthly summary variants

## Example Briefing Output

```
ğŸ“Š Daily Briefing â€” Tuesday, February 25, 2026

Instagram engagement up 23% this week â€” carousel posts driving the trend.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ¯ Performance Highlights

â€¢ "5 Questions Every Couple Should Ask" hit 12.4k views (Instagram)
â€¢ TikTok follower growth +142 this week (best week this month)
â€¢ Blog traffic up 31% from last week

## ğŸ“ˆ Last 7 Days

**Content Published:**
â€¢ Instagram: 5 posts (avg 8,200 views, 7.2% engagement)
â€¢ TikTok: 3 videos (avg 15,600 views, 9.8% engagement)
â€¢ Blog: 1 article (2,100 pageviews)

**Top Performer:**
"5 Questions Every Couple Should Ask" (Instagram)
12.4k views | 894 likes | 67 comments | 7.2% engagement

## ğŸŒ± Social Growth (7 Days)

â€¢ Instagram: 2,847 â†’ 2,931 (+84, +2.9%)
â€¢ TikTok: 4,512 â†’ 4,654 (+142, +3.1%)
â€¢ Pinterest: 892 â†’ 914 (+22, +2.5%)

## ğŸ’¡ Active Ideas (4)

â€¢ **Wedding Timeline Planning Guide** (proposed) â€” blog
â€¢ **Behind the Scenes: Editing Process** (in_progress) â€” tiktok
â€¢ **Venue Lighting Tips** (accepted) â€” instagram

_+ 1 more in pipeline_

## ğŸ“‹ Today's Tasks

**Standing Orders:**
â€¢ Lead Research (MWF)
â€¢ Blog Post Draft (Mon)

## âš ï¸ Areas to Watch

â€¢ Pinterest engagement dropped 15% week-over-week â€” may need fresh pin designs
â€¢ No blog content published since Feb 18 â€” pipeline running dry

## ğŸ’ª Recommendations

1. Double down on Instagram carousels â€” driving best engagement this month
2. Schedule Ada for 2-3 blog posts this week to fill content gap

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

_View full metrics in Mission Control â†’ AnselAI_
```

## Integration Points

**Depends on:**
- AnselAI Phase 2+ (social analytics syncing)
- Content Idea Pipeline (active ideas)
- Mission Control (task data)

**Used by:**
- Tyler (daily insights)
- Marcus (monitors business health)
- Future: weekly/monthly reports
